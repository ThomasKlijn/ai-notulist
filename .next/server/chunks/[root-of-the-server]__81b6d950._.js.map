{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/emailService.ts"],"sourcesContent":["import sgMail from '@sendgrid/mail';\n\n// Initialize SendGrid with API key\nif (!process.env.SENDGRID_API_KEY) {\n  console.warn('SENDGRID_API_KEY not found - email sending will be disabled');\n} else {\n  sgMail.setApiKey(process.env.SENDGRID_API_KEY);\n}\n\nconst VERIFIED_SENDER = process.env.VERIFIED_SENDER_EMAIL || 'noreply@ainotulist.com';\n\ninterface ConsentEmailData {\n  attendeeName?: string;\n  attendeeEmail: string;\n  meetingTitle: string;\n  organizerName?: string;\n  consentToken: string;\n  meetingDate: string;\n}\n\nexport class EmailService {\n  static async sendConsentRequest(data: ConsentEmailData): Promise<boolean> {\n    if (!process.env.SENDGRID_API_KEY) {\n      console.warn('Email sending disabled - no SendGrid API key');\n      return false;\n    }\n    \n    const consentUrl = `${process.env.REPL_URL || 'http://localhost:5000'}/consent/${data.consentToken}`;\n    \n    const msg = {\n      to: data.attendeeEmail,\n      from: VERIFIED_SENDER,\n      subject: `Consent Required: Recording Permission for \"${data.meetingTitle}\"`,\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <h2 style=\"color: #1f2937;\">Meeting Recording Consent Required</h2>\n          \n          <p>Hello ${data.attendeeName || 'there'},</p>\n          \n          <p>You have been invited to participate in a meeting that will be recorded for transcription and AI summary purposes.</p>\n          \n          <div style=\"background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n            <h3 style=\"margin-top: 0; color: #1f2937;\">Meeting Details</h3>\n            <p><strong>Title:</strong> ${data.meetingTitle}</p>\n            <p><strong>Organizer:</strong> ${data.organizerName || 'Meeting organizer'}</p>\n            <p><strong>Date:</strong> ${data.meetingDate}</p>\n          </div>\n          \n          <h3 style=\"color: #1f2937;\">Your Consent is Required</h3>\n          <p>Before this meeting can be recorded, we need your explicit consent for:</p>\n          <ul>\n            <li>Audio recording during the meeting</li>\n            <li>Automatic transcription via ElevenLabs speech-to-text</li>\n            <li>AI-generated meeting summary via OpenAI</li>\n            <li>Email delivery of meeting notes to participants</li>\n          </ul>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${consentUrl}\" \n               style=\"background-color: #10b981; color: white; padding: 16px 32px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n              Review & Give Consent\n            </a>\n          </div>\n          \n          <div style=\"background-color: #fef3c7; padding: 16px; border-radius: 6px; margin: 20px 0;\">\n            <p style=\"margin: 0; color: #92400e;\"><strong>Important:</strong> Recording cannot begin until all participants provide consent. You can withdraw your consent at any time, which will immediately stop processing and delete your audio data.</p>\n          </div>\n          \n          <p style=\"color: #6b7280; font-size: 14px;\">\n            For more information about how we handle your data, please read our \n            <a href=\"${process.env.REPL_URL || 'http://localhost:5000'}/privacy\" style=\"color: #3b82f6;\">privacy policy</a>.\n          </p>\n          \n          <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\" />\n          <p style=\"color: #9ca3af; font-size: 12px; text-align: center;\">\n            AI Notulist - Automated Meeting Notes<br>\n            This email was sent regarding meeting consent. If you did not expect this email, please contact the meeting organizer.\n          </p>\n        </div>\n      `,\n      text: `\nMeeting Recording Consent Required\n\nHello ${data.attendeeName || 'there'},\n\nYou have been invited to participate in a meeting that will be recorded for transcription and AI summary purposes.\n\nMeeting Details:\n- Title: ${data.meetingTitle}\n- Organizer: ${data.organizerName || 'Meeting organizer'}  \n- Date: ${data.meetingDate}\n\nYour consent is required for:\n- Audio recording during the meeting\n- Automatic transcription via ElevenLabs speech-to-text\n- AI-generated meeting summary via OpenAI\n- Email delivery of meeting notes to participants\n\nPlease visit the following link to review and provide your consent:\n${consentUrl}\n\nImportant: Recording cannot begin until all participants provide consent. You can withdraw your consent at any time.\n\nFor more information: ${process.env.REPL_URL || 'http://localhost:5000'}/privacy\n\nAI Notulist - Automated Meeting Notes\n      `\n    };\n\n    try {\n      await sgMail.send(msg);\n      console.log(`Consent email sent to ${data.attendeeEmail} for meeting ${data.meetingTitle}`);\n      return true;\n    } catch (error) {\n      console.error('Failed to send consent email:', error);\n      return false;\n    }\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,mCAAmC;AACnC,IAAI,CAAC,QAAQ,GAAG,CAAC,gBAAgB,EAAE;IACjC,QAAQ,IAAI,CAAC;AACf,OAAO;IACL,wJAAM,CAAC,SAAS,CAAC,QAAQ,GAAG,CAAC,gBAAgB;AAC/C;AAEA,MAAM,kBAAkB,QAAQ,GAAG,CAAC,qBAAqB,IAAI;AAWtD,MAAM;IACX,aAAa,mBAAmB,IAAsB,EAAoB;QACxE,IAAI,CAAC,QAAQ,GAAG,CAAC,gBAAgB,EAAE;YACjC,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;QAEA,MAAM,aAAa,GAAG,QAAQ,GAAG,CAAC,QAAQ,IAAI,wBAAwB,SAAS,EAAE,KAAK,YAAY,EAAE;QAEpG,MAAM,MAAM;YACV,IAAI,KAAK,aAAa;YACtB,MAAM;YACN,SAAS,CAAC,4CAA4C,EAAE,KAAK,YAAY,CAAC,CAAC,CAAC;YAC5E,MAAM,CAAC;;;;mBAIM,EAAE,KAAK,YAAY,IAAI,QAAQ;;;;;;uCAMX,EAAE,KAAK,YAAY,CAAC;2CAChB,EAAE,KAAK,aAAa,IAAI,oBAAoB;sCACjD,EAAE,KAAK,WAAW,CAAC;;;;;;;;;;;;;qBAapC,EAAE,WAAW;;;;;;;;;;;;qBAYb,EAAE,QAAQ,GAAG,CAAC,QAAQ,IAAI,wBAAwB;;;;;;;;;MASjE,CAAC;YACD,MAAM,CAAC;;;MAGP,EAAE,KAAK,YAAY,IAAI,QAAQ;;;;;SAK5B,EAAE,KAAK,YAAY,CAAC;aAChB,EAAE,KAAK,aAAa,IAAI,oBAAoB;QACjD,EAAE,KAAK,WAAW,CAAC;;;;;;;;;AAS3B,EAAE,WAAW;;;;sBAIS,EAAE,QAAQ,GAAG,CAAC,QAAQ,IAAI,wBAAwB;;;MAGlE,CAAC;QACH;QAEA,IAAI;YACF,MAAM,wJAAM,CAAC,IAAI,CAAC;YAClB,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,KAAK,aAAa,CAAC,aAAa,EAAE,KAAK,YAAY,EAAE;YAC1F,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO;QACT;IACF;AACF","debugId":null}}]
}