{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/server/emailService.ts"],"sourcesContent":["import { MailService } from '@sendgrid/mail';\nimport { MeetingSummary } from './openai';\n\nif (!process.env.SENDGRID_API_KEY) {\n  throw new Error(\"SENDGRID_API_KEY environment variable must be set\");\n}\n\nconst mailService = new MailService();\nmailService.setApiKey(process.env.SENDGRID_API_KEY);\n\nexport interface EmailAttendee {\n  name?: string;\n  email: string;\n  role?: string;\n}\n\nexport class EmailService {\n  // Send meeting summary to all attendees\n  async sendMeetingSummary(\n    meetingTitle: string,\n    attendees: EmailAttendee[],\n    transcription: string,\n    summary: MeetingSummary,\n    language: string = 'nl'\n  ): Promise<boolean> {\n    try {\n      console.log(`üìß EmailService.sendMeetingSummary called with:`);\n      console.log(`  - Title: ${meetingTitle}`);\n      console.log(`  - Attendees: ${attendees.length} (${attendees.map(a => a.email).join(', ')})`);\n      console.log(`  - Language: ${language}`);\n      console.log(`  - Summary keys: ${Object.keys(summary)}`);\n      \n      const isEnglish = language === 'en';\n      \n      // Create email content\n      const subject = isEnglish \n        ? `Meeting Summary: ${meetingTitle}`\n        : `Meeting Samenvatting: ${meetingTitle}`;\n\n      console.log(`üìß Email subject: ${subject}`);\n\n      const htmlContent = this.generateEmailHTML(summary, transcription, isEnglish);\n      const textContent = this.generateEmailText(summary, transcription, isEnglish);\n      \n      console.log(`üìß Email content generated, HTML length: ${htmlContent.length}, text length: ${textContent.length}`);\n\n      // Send to each attendee\n      console.log(`üìß Preparing to send emails to ${attendees.length} attendees...`);\n      const emailPromises = attendees.map((attendee, index) => {\n        console.log(`üìß Sending email ${index + 1}/${attendees.length} to: ${attendee.email}`);\n        return mailService.send({\n          to: attendee.email,\n          from: process.env.VERIFIED_SENDER_EMAIL || 'test@yourdomain.com', // Must be verified in SendGrid\n          subject: subject,\n          text: textContent,\n          html: htmlContent,\n        });\n      });\n\n      console.log(`üìß Executing ${emailPromises.length} email sends...`);\n      await Promise.all(emailPromises);\n      console.log(`‚úÖ Meeting summary sent to ${attendees.length} attendees`);\n      return true;\n    } catch (error: any) {\n      console.error('‚ùå SendGrid email error:', error);\n      console.error('‚ùå Error details:', error?.response?.body || error?.message || error);\n      return false;\n    }\n  }\n\n  // Generate HTML email content\n  private generateEmailHTML(summary: MeetingSummary, transcription: string, isEnglish: boolean): string {\n    const labels = isEnglish ? {\n      title: 'Meeting Summary',\n      generalSummary: 'Summary',\n      keyPoints: 'Key Discussion Points',\n      decisions: 'Decisions Made',\n      actionItems: 'Action Items',\n      participants: 'Participants',\n      duration: 'Duration',\n      nextSteps: 'Next Steps',\n      fullTranscript: 'Full Transcript',\n      task: 'Task',\n      assignee: 'Assignee',\n      dueDate: 'Due Date'\n    } : {\n      title: 'Meeting Samenvatting',\n      generalSummary: 'Samenvatting',\n      keyPoints: 'Belangrijke Discussiepunten',\n      decisions: 'Genomen Beslissingen',\n      actionItems: 'Actiepunten',\n      participants: 'Deelnemers',\n      duration: 'Duur',\n      nextSteps: 'Volgende Stappen',\n      fullTranscript: 'Volledige Transcriptie',\n      task: 'Taak',\n      assignee: 'Toegewezen aan',\n      dueDate: 'Deadline'\n    };\n\n    return `\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }\n        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }\n        h2 { color: #34495e; margin-top: 25px; }\n        ul, ol { margin: 10px 0; padding-left: 25px; }\n        li { margin: 5px 0; }\n        .action-item { background: #f8f9fa; padding: 10px; margin: 5px 0; border-left: 4px solid #007bff; }\n        .info-box { background: #e9ecef; padding: 15px; border-radius: 5px; margin: 15px 0; }\n        .transcript { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 20px; font-size: 14px; }\n    </style>\n</head>\n<body>\n    <h1>${labels.title}: ${summary.title}</h1>\n    \n    <div class=\"info-box\">\n        <strong>${labels.participants}:</strong> ${summary.participants.join(', ')}<br>\n        <strong>${labels.duration}:</strong> ${summary.duration}\n    </div>\n\n    <h2>${labels.generalSummary}</h2>\n    <p style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0; line-height: 1.6;\">${summary.generalSummary}</p>\n\n    <h2>${labels.keyPoints}</h2>\n    <ul>\n        ${summary.keyPoints.map(point => `<li>${point}</li>`).join('')}\n    </ul>\n\n    <h2>${labels.decisions}</h2>\n    <ul>\n        ${summary.decisions.map(decision => `<li>${decision}</li>`).join('')}\n    </ul>\n\n    <h2>${labels.actionItems}</h2>\n    ${summary.actionItems.map(item => `\n        <div class=\"action-item\">\n            <strong>${labels.task}:</strong> ${item.task}<br>\n            ${item.assignee ? `<strong>${labels.assignee}:</strong> ${item.assignee}<br>` : ''}\n            ${item.dueDate ? `<strong>${labels.dueDate}:</strong> ${item.dueDate}` : ''}\n        </div>\n    `).join('')}\n\n    ${summary.nextSteps ? `\n        <h2>${labels.nextSteps}</h2>\n        <ul>\n            ${summary.nextSteps.map(step => `<li>${step}</li>`).join('')}\n        </ul>\n    ` : ''}\n\n    <div class=\"transcript\">\n        <h2>${labels.fullTranscript}</h2>\n        <p>${transcription}</p>\n    </div>\n</body>\n</html>`;\n  }\n\n  // Generate plain text email content\n  private generateEmailText(summary: MeetingSummary, transcription: string, isEnglish: boolean): string {\n    const labels = isEnglish ? {\n      title: 'MEETING SUMMARY',\n      generalSummary: 'SUMMARY',\n      keyPoints: 'KEY DISCUSSION POINTS',\n      decisions: 'DECISIONS MADE',\n      actionItems: 'ACTION ITEMS',\n      participants: 'Participants',\n      duration: 'Duration',\n      nextSteps: 'NEXT STEPS',\n      fullTranscript: 'FULL TRANSCRIPT',\n      task: 'Task',\n      assignee: 'Assignee',\n      dueDate: 'Due Date'\n    } : {\n      title: 'MEETING SAMENVATTING',\n      generalSummary: 'SAMENVATTING',\n      keyPoints: 'BELANGRIJKE DISCUSSIEPUNTEN',\n      decisions: 'GENOMEN BESLISSINGEN',\n      actionItems: 'ACTIEPUNTEN',\n      participants: 'Deelnemers',\n      duration: 'Duur',\n      nextSteps: 'VOLGENDE STAPPEN',\n      fullTranscript: 'VOLLEDIGE TRANSCRIPTIE',\n      task: 'Taak',\n      assignee: 'Toegewezen aan',\n      dueDate: 'Deadline'\n    };\n\n    return `\n${labels.title}: ${summary.title}\n\n${labels.participants}: ${summary.participants.join(', ')}\n${labels.duration}: ${summary.duration}\n\n${labels.generalSummary}:\n${summary.generalSummary}\n\n${labels.keyPoints}:\n${summary.keyPoints.map(point => `‚Ä¢ ${point}`).join('\\n')}\n\n${labels.decisions}:\n${summary.decisions.map(decision => `‚Ä¢ ${decision}`).join('\\n')}\n\n${labels.actionItems}:\n${summary.actionItems.map(item => \n  `‚Ä¢ ${labels.task}: ${item.task}${item.assignee ? `\\n  ${labels.assignee}: ${item.assignee}` : ''}${item.dueDate ? `\\n  ${labels.dueDate}: ${item.dueDate}` : ''}`\n).join('\\n')}\n\n${summary.nextSteps ? `${labels.nextSteps}:\\n${summary.nextSteps.map(step => `‚Ä¢ ${step}`).join('\\n')}\\n` : ''}\n\n${labels.fullTranscript}:\n${transcription}\n    `.trim();\n  }\n}\n\nexport const emailService = new EmailService();"],"names":[],"mappings":";;;;;;AAAA;;AAGA,IAAI,CAAC,QAAQ,GAAG,CAAC,gBAAgB,EAAE;IACjC,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,cAAc,IAAI,4JAAW;AACnC,YAAY,SAAS,CAAC,QAAQ,GAAG,CAAC,gBAAgB;AAQ3C,MAAM;IACX,wCAAwC;IACxC,MAAM,mBACJ,YAAoB,EACpB,SAA0B,EAC1B,aAAqB,EACrB,OAAuB,EACvB,WAAmB,IAAI,EACL;QAClB,IAAI;YACF,QAAQ,GAAG,CAAC,CAAC,+CAA+C,CAAC;YAC7D,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,cAAc;YACxC,QAAQ,GAAG,CAAC,CAAC,eAAe,EAAE,UAAU,MAAM,CAAC,EAAE,EAAE,UAAU,GAAG,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAC5F,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,UAAU;YACvC,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,OAAO,IAAI,CAAC,UAAU;YAEvD,MAAM,YAAY,aAAa;YAE/B,uBAAuB;YACvB,MAAM,UAAU,YACZ,CAAC,iBAAiB,EAAE,cAAc,GAClC,CAAC,sBAAsB,EAAE,cAAc;YAE3C,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,SAAS;YAE1C,MAAM,cAAc,IAAI,CAAC,iBAAiB,CAAC,SAAS,eAAe;YACnE,MAAM,cAAc,IAAI,CAAC,iBAAiB,CAAC,SAAS,eAAe;YAEnE,QAAQ,GAAG,CAAC,CAAC,yCAAyC,EAAE,YAAY,MAAM,CAAC,eAAe,EAAE,YAAY,MAAM,EAAE;YAEhH,wBAAwB;YACxB,QAAQ,GAAG,CAAC,CAAC,+BAA+B,EAAE,UAAU,MAAM,CAAC,aAAa,CAAC;YAC7E,MAAM,gBAAgB,UAAU,GAAG,CAAC,CAAC,UAAU;gBAC7C,QAAQ,GAAG,CAAC,CAAC,iBAAiB,EAAE,QAAQ,EAAE,CAAC,EAAE,UAAU,MAAM,CAAC,KAAK,EAAE,SAAS,KAAK,EAAE;gBACrF,OAAO,YAAY,IAAI,CAAC;oBACtB,IAAI,SAAS,KAAK;oBAClB,MAAM,QAAQ,GAAG,CAAC,qBAAqB,IAAI;oBAC3C,SAAS;oBACT,MAAM;oBACN,MAAM;gBACR;YACF;YAEA,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,cAAc,MAAM,CAAC,eAAe,CAAC;YACjE,MAAM,QAAQ,GAAG,CAAC;YAClB,QAAQ,GAAG,CAAC,CAAC,0BAA0B,EAAE,UAAU,MAAM,CAAC,UAAU,CAAC;YACrE,OAAO;QACT,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,2BAA2B;YACzC,QAAQ,KAAK,CAAC,oBAAoB,OAAO,UAAU,QAAQ,OAAO,WAAW;YAC7E,OAAO;QACT;IACF;IAEA,8BAA8B;IACtB,kBAAkB,OAAuB,EAAE,aAAqB,EAAE,SAAkB,EAAU;QACpG,MAAM,SAAS,YAAY;YACzB,OAAO;YACP,gBAAgB;YAChB,WAAW;YACX,WAAW;YACX,aAAa;YACb,cAAc;YACd,UAAU;YACV,WAAW;YACX,gBAAgB;YAChB,MAAM;YACN,UAAU;YACV,SAAS;QACX,IAAI;YACF,OAAO;YACP,gBAAgB;YAChB,WAAW;YACX,WAAW;YACX,aAAa;YACb,cAAc;YACd,UAAU;YACV,WAAW;YACX,gBAAgB;YAChB,MAAM;YACN,UAAU;YACV,SAAS;QACX;QAEA,OAAO,CAAC;;;;;;;;;;;;;;;;;QAiBJ,EAAE,OAAO,KAAK,CAAC,EAAE,EAAE,QAAQ,KAAK,CAAC;;;gBAGzB,EAAE,OAAO,YAAY,CAAC,WAAW,EAAE,QAAQ,YAAY,CAAC,IAAI,CAAC,MAAM;gBACnE,EAAE,OAAO,QAAQ,CAAC,WAAW,EAAE,QAAQ,QAAQ,CAAC;;;QAGxD,EAAE,OAAO,cAAc,CAAC;yGACyE,EAAE,QAAQ,cAAc,CAAC;;QAE1H,EAAE,OAAO,SAAS,CAAC;;QAEnB,EAAE,QAAQ,SAAS,CAAC,GAAG,CAAC,CAAA,QAAS,CAAC,IAAI,EAAE,MAAM,KAAK,CAAC,EAAE,IAAI,CAAC,IAAI;;;QAG/D,EAAE,OAAO,SAAS,CAAC;;QAEnB,EAAE,QAAQ,SAAS,CAAC,GAAG,CAAC,CAAA,WAAY,CAAC,IAAI,EAAE,SAAS,KAAK,CAAC,EAAE,IAAI,CAAC,IAAI;;;QAGrE,EAAE,OAAO,WAAW,CAAC;IACzB,EAAE,QAAQ,WAAW,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC;;oBAEnB,EAAE,OAAO,IAAI,CAAC,WAAW,EAAE,KAAK,IAAI,CAAC;YAC7C,EAAE,KAAK,QAAQ,GAAG,CAAC,QAAQ,EAAE,OAAO,QAAQ,CAAC,WAAW,EAAE,KAAK,QAAQ,CAAC,IAAI,CAAC,GAAG,GAAG;YACnF,EAAE,KAAK,OAAO,GAAG,CAAC,QAAQ,EAAE,OAAO,OAAO,CAAC,WAAW,EAAE,KAAK,OAAO,EAAE,GAAG,GAAG;;IAEpF,CAAC,EAAE,IAAI,CAAC,IAAI;;IAEZ,EAAE,QAAQ,SAAS,GAAG,CAAC;YACf,EAAE,OAAO,SAAS,CAAC;;YAEnB,EAAE,QAAQ,SAAS,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC,IAAI,EAAE,KAAK,KAAK,CAAC,EAAE,IAAI,CAAC,IAAI;;IAErE,CAAC,GAAG,GAAG;;;YAGC,EAAE,OAAO,cAAc,CAAC;WACzB,EAAE,cAAc;;;OAGpB,CAAC;IACN;IAEA,oCAAoC;IAC5B,kBAAkB,OAAuB,EAAE,aAAqB,EAAE,SAAkB,EAAU;QACpG,MAAM,SAAS,YAAY;YACzB,OAAO;YACP,gBAAgB;YAChB,WAAW;YACX,WAAW;YACX,aAAa;YACb,cAAc;YACd,UAAU;YACV,WAAW;YACX,gBAAgB;YAChB,MAAM;YACN,UAAU;YACV,SAAS;QACX,IAAI;YACF,OAAO;YACP,gBAAgB;YAChB,WAAW;YACX,WAAW;YACX,aAAa;YACb,cAAc;YACd,UAAU;YACV,WAAW;YACX,gBAAgB;YAChB,MAAM;YACN,UAAU;YACV,SAAS;QACX;QAEA,OAAO,CAAC;AACZ,EAAE,OAAO,KAAK,CAAC,EAAE,EAAE,QAAQ,KAAK,CAAC;;AAEjC,EAAE,OAAO,YAAY,CAAC,EAAE,EAAE,QAAQ,YAAY,CAAC,IAAI,CAAC,MAAM;AAC1D,EAAE,OAAO,QAAQ,CAAC,EAAE,EAAE,QAAQ,QAAQ,CAAC;;AAEvC,EAAE,OAAO,cAAc,CAAC;AACxB,EAAE,QAAQ,cAAc,CAAC;;AAEzB,EAAE,OAAO,SAAS,CAAC;AACnB,EAAE,QAAQ,SAAS,CAAC,GAAG,CAAC,CAAA,QAAS,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,MAAM;;AAE1D,EAAE,OAAO,SAAS,CAAC;AACnB,EAAE,QAAQ,SAAS,CAAC,GAAG,CAAC,CAAA,WAAY,CAAC,EAAE,EAAE,UAAU,EAAE,IAAI,CAAC,MAAM;;AAEhE,EAAE,OAAO,WAAW,CAAC;AACrB,EAAE,QAAQ,WAAW,CAAC,GAAG,CAAC,CAAA,OACxB,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,EAAE,EAAE,KAAK,IAAI,GAAG,KAAK,QAAQ,GAAG,CAAC,IAAI,EAAE,OAAO,QAAQ,CAAC,EAAE,EAAE,KAAK,QAAQ,EAAE,GAAG,KAAK,KAAK,OAAO,GAAG,CAAC,IAAI,EAAE,OAAO,OAAO,CAAC,EAAE,EAAE,KAAK,OAAO,EAAE,GAAG,IAAI,EACjK,IAAI,CAAC,MAAM;;AAEb,EAAE,QAAQ,SAAS,GAAG,GAAG,OAAO,SAAS,CAAC,GAAG,EAAE,QAAQ,SAAS,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG;;AAE9G,EAAE,OAAO,cAAc,CAAC;AACxB,EAAE,cAAc;IACZ,CAAC,CAAC,IAAI;IACR;AACF;AAEO,MAAM,eAAe,IAAI","debugId":null}}]
}